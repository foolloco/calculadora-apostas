<script>
let players = [];
let round = 1;
let betValue = 1;
let totalInvested = 0;

function addPlayer() {
  const name = prompt("Nome do jogador:");
  const deposit = parseFloat(prompt("Valor que o jogador está depositando:"));
  if (!name || isNaN(deposit) || deposit <= 0) return;

  players.push({
    name,
    balance: deposit,
    eliminated: false,
    cruca: false,
    crucaUsed: false,
    invested: deposit
  });
  totalInvested += deposit;
  updateUI();
}

function removePlayer(index) {
  totalInvested -= players[index].invested;
  players.splice(index, 1);
  updateUI();
}

function depositMoney(index) {
  const amount = parseFloat(prompt("Quanto deseja adicionar?"));
  if (isNaN(amount) || amount <= 0) return;
  players[index].balance += amount;
  players[index].invested += amount;
  totalInvested += amount;
  updateUI();
}

function changeBetValue() {
  const newBet = parseFloat(prompt("Novo valor da aposta:"));
  if (!isNaN(newBet) && newBet > 0) {
    betValue = newBet;
    updateUI();
  }
}

function playRound() {
  const winnerIndex = parseInt(prompt("Índice do jogador vencedor (0 a " + (players.length - 1) + "):"));
  if (isNaN(winnerIndex) || winnerIndex < 0 || winnerIndex >= players.length || players[winnerIndex].eliminated) return;

  let pot = 0;
  for (let i = 0; i < players.length; i++) {
    if (!players[i].eliminated && players[i].balance >= betValue) {
      players[i].balance -= betValue;
      pot += betValue;
    }
  }

  players[winnerIndex].balance += pot;

  for (let i = 0; i < players.length; i++) {
    if (!players[i].eliminated && players[i].balance === 0) {
      if (players[i].cruca) {
        players[i].eliminated = true;
      } else if (!players[i].crucaUsed) {
        players[i].cruca = true;
      } else {
        players[i].eliminated = true;
      }
    }
  }

  // Se o vencedor estava na cruca, ele sai da cruca e marca como usada
  if (players[winnerIndex].cruca) {
    players[winnerIndex].cruca = false;
    players[winnerIndex].crucaUsed = true;
  }

  // Histórico
  const contributors = players.filter((p, i) => i !== winnerIndex && !p.eliminated && p.balance + betValue >= betValue);
  const amountWon = contributors.length * betValue;

  const history = document.getElementById("history");
  const entry = document.createElement("li");
  entry.textContent = `Rodada ${round}: ${players[winnerIndex].name} ganhou R$${amountWon}`;
  history.appendChild(entry);

  round++;
  updateUI();
}

function resetGame() {
  players = [];
  round = 1;
  betValue = 1;
  totalInvested = 0;
  document.getElementById("history").innerHTML = "";
  updateUI();
}

function updateUI() {
  const playerList = document.getElementById("players");
  playerList.innerHTML = "";
  players.forEach((p, index) => {
    const li = document.createElement("li");
    li.textContent = `${index} - ${p.name}: R$${p.balance} ${p.eliminated ? "(Eliminado)" : p.cruca ? "(Cruca)" : ""}`;
    
    const removeBtn = document.createElement("button");
    removeBtn.textContent = "Remover";
    removeBtn.onclick = () => removePlayer(index);

    const depositBtn = document.createElement("button");
    depositBtn.textContent = "+ Dinheiro";
    depositBtn.onclick = () => depositMoney(index);

    li.appendChild(removeBtn);
    li.appendChild(depositBtn);

    playerList.appendChild(li);
  });
  document.getElementById("betDisplay").textContent = betValue;
  document.getElementById("totalInvested").textContent = totalInvested;
}
</script>

<h1>Calculadora de Apostas</h1>
<button onclick="addPlayer()">Adicionar Jogador</button>
<button onclick="playRound()">Nova Rodada</button>
<button onclick="changeBetValue()">Alterar Valor da Aposta</button>
<button onclick="resetGame()">Resetar</button>
<p>Valor da aposta atual: R$<span id="betDisplay">1</span></p>
<p>Total investido: R$<span id="totalInvested">0</span></p>
<ul id="players"></ul>
<h2>Histórico</h2>
<ul id="history"></ul>
